<!DOCTYPE html>
<html><head>
<meta charset="utf-8"/>
<link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect"/>
<link as="style" href="https://fonts.googleapis.com/css2?display=swap&family=Inter%3Awght%40400%3B500%3B600%3B700%3B900&family=Noto+Sans%3Awght%40400%3B500%3B600%3B700%3B900" onload="this.rel='stylesheet'" rel="stylesheet"/>
<title>CrowdScout</title>
<link href="data:image/x-icon;base64," rel="icon" type="image/x-icon"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<style type="text/tailwindcss">
    :root {
      --primary-50: #f7fdf0;
      --primary-100: #eefad9;
      --primary-200: #dff6ba;
      --primary-300: #c9eea7;
      --primary-400: #b1e48b;
      --primary-500: #99e550;
      --primary-600: #74c13a;
      --primary-700: #58962e;
      --primary-800: #447526;
      --primary-900: #396122;
      --primary-950: #1b350e;
      --secondary-50: #f2f7f5;
      --secondary-100: #e4eee9;
      --secondary-200: #c9ddd4;
      --secondary-300: #a7c6b9;
      --secondary-400: #82ab9a;
      --secondary-500: #658e7f;
      --secondary-600: #527366;
      --secondary-700: #445f55;
      --secondary-800: #384d45;
      --secondary-900: #30413a;
      --secondary-950: #1a2420;
      --surface-0: #111312;
      --surface-50: #171a18;
      --surface-100: #262e2a;
      --surface-200: #3f4e46;
      --surface-300: #576e62;
      --surface-400: #6e8e7d;
      --surface-500: #8cae9d;
      --surface-600: #a9c8b9;
      --surface-700: #c6e0d4;
      --surface-800: #e2f4ea;
      --surface-900: #f1faf5;
      --surface-950: #ffffff;
    }
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .animate-fadeIn {
      animation: fadeIn 0.5s ease-out forwards;
    }
    
    /* Profile dropdown styles */
    .profile-container {
      position: relative;
    }
    .profile-btn {
      background: none;
      border: none;
      padding: 0;
      cursor: pointer;
    }
    .profile-avatar {
      height: 40px;
      width: 40px;
      border-radius: 50%;
      object-fit: cover;
      transition: transform 0.3s;
    }
    .profile-avatar:hover {
      transform: scale(1.1);
    }
    .dropdown {
      display: flex; /* FIX: Added display: flex */
      flex-direction: column; /* FIX: Added flex-direction: column to stack items */
      position: absolute;
      right: 0;
      top: calc(100% + 8px);
      background: var(--surface-50);
      border: 1px solid var(--surface-100);
      border-radius: 8px;
      min-width: 180px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
      z-index: 1000;
      overflow: hidden;
    }
    .dropdown button,
    .dropdown a {
      display: flex;
      align-items: center;
      width: 100%;
      padding: 10px 14px;
      background: none;
      border: none;
      color: var(--surface-950);
      text-decoration: none;
      font-size: 14px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .dropdown button:hover,
    .dropdown a:hover {
      background: var(--surface-100);
    }
    
    /* Modal styles */
    .modal-centered {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }
    .card {
      position: relative;
      background: var(--surface-50);
      border: 1px solid var(--surface-100);
      border-radius: 16px;
      padding: 32px;
      max-width: 450px;
      width: 90%;
    }
    .bg-gradient-dark {
      background: linear-gradient(to bottom right, var(--surface-50), var(--surface-0));
    }
    .text-white {
      color: var(--surface-950);
    }
    .modal-centered input {
      width: 100%;
      padding: 12px;
      background: var(--surface-0);
      border: 1px solid var(--surface-100);
      border-radius: 8px;
      color: var(--surface-950);
      font-size: 14px;
    }
    .modal-centered input:focus {
      outline: none;
      border-color: var(--primary-500);
      box-shadow: 0 0 0 2px rgba(153, 229, 80, 0.2);
    }
    .cta {
      background: var(--primary-500);
      color: var(--primary-950);
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }
    .cta:hover {
      background: var(--primary-400);
      transform: translateY(-2px);
    }
    .small-muted {
      font-size: 12px;
      color: var(--surface-400);
      text-align: center;
      margin-top: 8px;
    }
    /* New Error Style */
    .error-display {
      background: rgba(220, 38, 38, 0.2); /* bg-red-700/20 */
      border: 1px solid rgba(220, 38, 38, 0.7); /* border-red-700 */
      color: rgba(252, 165, 165, 1); /* text-red-300 */
      padding: 10px;
      border-radius: 8px;
      font-size: 14px;
      margin-top: 10px;
      text-align: center;
    }
  </style>
</head>
<body class="bg-[var(--surface-0)] text-[var(--surface-900)]">
<div class="relative flex size-full min-h-screen flex-col" style='font-family: Inter, "Noto Sans", sans-serif;'>
<div class="flex h-full grow flex-col">
<header class="sticky top-0 z-20 flex items-center justify-between whitespace-nowrap border-b border-[var(--surface-100)] bg-[var(--surface-0)]/80 px-10 py-4 backdrop-blur-lg">
<div class="flex items-center gap-10">
<a class="flex items-center gap-3 text-[var(--surface-950)]" href="https://elixtion.github.io/test">
<img class="h-12 w-12" src="https://raw.githubusercontent.com/Elixtion/elixtion.github.io/refs/heads/main/images/Untitled%20design%20(3).png" alt="CrowdScout Logo">
<h1 class="text-xl font-bold">CrowdScout</h1>
</a>
<nav class="flex items-center gap-2">
<a class="relative rounded-md px-4 py-2 text-sm font-semibold text-[var(--surface-500)] transition-colors hover:text-[var(--surface-950)]" href="#">Teams</a>
<a class="relative rounded-md px-4 py-2 text-sm font-semibold text-[var(--surface-500)] transition-colors hover:text-[var(--surface-950)]" href="#">Events</a>
<a class="relative rounded-md px-4 py-2 text-sm font-semibold text-[var(--surface-500)] transition-colors hover:text-[var(--surface-950)]" href="#">Matches</a>
</nav>
</div>
<div class="flex flex-1 items-center justify-end gap-4">
<label class="relative flex w-full max-w-xs">
<div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3 text-[var(--surface-500)]">
<span class="material-symbols-outlined text-xl"> search </span>
</div>
<input class="h-10 w-full rounded-md border border-transparent bg-[var(--surface-50)] py-2 pl-10 pr-4 text-sm text-[var(--surface-950)] placeholder:text-[var(--surface-500)] transition-colors focus:border-[var(--primary-500)] focus:bg-[var(--surface-0)] focus:outline-none focus:ring-1 focus:ring-[var(--primary-500)]" placeholder="Search for a team or event" value=""/>
</label>
<a href="https://elixtion.github.io/input" target="_blank" 
   class="flex h-10 flex-shrink-0 cursor-pointer items-center justify-center gap-2 rounded-md bg-[var(--surface-950)] px-4 text-sm font-semibold text-black transition-colors hover:bg-[var(--surface-800)]">
  <span>Input Data</span>
  <span class="material-symbols-outlined text-xl"> open_in_new </span>
</a>

<div class="profile-container">
  <button id="profileBtn" class="profile-btn flex-shrink-0" aria-label="Profile">
    <img id="landingAvatar" class="profile-avatar" src="https://upload.wikimedia.org/wikipedia/commons/a/aa/Sin_cara.png" alt="avatar"/>
  </button>

  <div id="profileDropdown" class="dropdown" role="menu" aria-hidden="true">
    <button id="signupOpen">Sign Up</button>
    <button id="loginLinkBtn">Login</button>
    <a href="https://www.chiefdelphi.com" target="_blank" rel="noopener">Chief Delphi <span class="material-symbols-outlined" style="margin-left:auto;font-size:18px">open_in_new</span></a>
  </div>
</div>
</div>
</header>
<main class="flex-1 px-10 py-12">
<div class="mx-auto max-w-7xl">
<div class="@container">
<div class="@[480px]:p-4">
<div class="relative flex min-h-[480px] flex-col items-start justify-end overflow-hidden rounded-2xl bg-cover bg-center bg-no-repeat px-4 pb-10 shadow-2xl shadow-black/30 @[480px]:px-10" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuDXwpVjuNorxiuUAExlL7E_FITVBy_0jgqJSTJE1v-aXB1ydHcmKAju5QNsFUuYiU15_nPN-wK_pnVl32MoqHPPbwwBiQLZfTLRCYtyz3hFB7ibXK_pySqIMOmD58wvufjrtNMv91_3I8_ICZgzXh2PkrcKWxmsXmNgJ2leF0dBTOvRodnqCOeJea_IJhb2eGJD5p_m-cSBUynpByv4wrHwr_WAtSxmi0Hl96QdpRbhQ5WCCCkxigMEsins1UxjeK3nDcOe7FNn13w");'>
<div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent"></div>
<div class="relative z-10 flex animate-fadeIn flex-col gap-4 text-left">
<h1 class="text-4xl font-extrabold tracking-tighter text-white @[280px]:text-7xl">Unlock the Power of CrowdScout</h1>
<p class="max-w-2xl text-base text-[var(--surface-600)] @[480px]:text-xl">
                    Transform raw data into actionable intelligence with our intuitive analytics platform. Gain a competitive edge by understanding your audience, optimizing your strategies, and driving growth.
                  </p>
<button class="flex h-12 w-fit cursor-pointer items-center justify-center rounded-lg bg-[var(--primary-500)] px-6 text-base font-bold text-[var(--primary-950)] shadow-lg transition-transform duration-300 ease-in-out hover:-translate-y-1 hover:bg-[var(--primary-400)] hover:shadow-2xl hover:shadow-[var(--primary-500)]/40">
<span class="truncate">Get Started</span>
</button>
</div>
</div>
</div>
</div>
<div class="flex flex-col gap-12 py-24">
<div class="flex flex-col gap-4 text-center">
<h2 class="text-5xl font-extrabold tracking-tighter text-white">Key Features</h2>
<p class="mx-auto max-w-2xl text-lg text-[var(--surface-400)]">
                Our platform offers a comprehensive suite of tools to analyze and visualize your data effectively.
              </p>
</div>
<div class="grid grid-cols-1 gap-8 md:grid-cols-2 lg:grid-cols-3">
<div class="group flex flex-col gap-4 rounded-xl border border-[var(--surface-100)] bg-gradient-to-br from-[var(--surface-50)] to-[var(--surface-0)] p-6 transition-all duration-300 hover:border-[var(--primary-700)] hover:shadow-2xl hover:shadow-[var(--primary-900)]/50">
<div class="flex h-12 w-12 items-center justify-center rounded-lg bg-[var(--primary-900)] text-[var(--primary-300)] transition-all duration-300 group-hover:bg-[var(--primary-500)] group-hover:text-[var(--primary-950)]">
<span class="material-symbols-outlined text-3xl"> bar_chart_4_bars </span>
</div>
<div class="flex flex-col gap-2">
<h3 class="text-xl font-bold text-white">Interactive Dashboards</h3>
<p class="text-[var(--surface-400)]">Create dynamic and customizable dashboards to track key metrics and trends in real-time.</p>
</div>
</div>
<div class="group flex flex-col gap-4 rounded-xl border border-[var(--surface-100)] bg-gradient-to-br from-[var(--surface-50)] to-[var(--surface-0)] p-6 transition-all duration-300 hover:border-[var(--primary-700)] hover:shadow-2xl hover:shadow-[var(--primary-900)]/50">
<div class="flex h-12 w-12 items-center justify-center rounded-lg bg-[var(--primary-900)] text-[var(--primary-300)] transition-all duration-300 group-hover:bg-[var(--primary-500)] group-hover:text-[var(--primary-950)]">
<span class="material-symbols-outlined text-3xl"> groups </span>
</div>
<div class="flex flex-col gap-2">
<h3 class="text-xl font-bold text-white">Team Collaboration</h3>
<p class="text-[var(--surface-400)]">Collaborate seamlessly with your team, share insights, and work together to achieve your goals.</p>
</div>
</div>
<div class="group flex flex-col gap-4 rounded-xl border border-[var(--surface-100)] bg-gradient-to-br from-[var(--surface-50)] to-[var(--surface-0)] p-6 transition-all duration-300 hover:border-[var(--primary-700)] hover:shadow-2xl hover:shadow-[var(--primary-900)]/50">
<div class="flex h-12 w-12 items-center justify-center rounded-lg bg-[var(--primary-900)] text-[var(--primary-300)] transition-all duration-300 group-hover:bg-[var(--primary-500)] group-hover:text-[var(--primary-950)]">
<span class="material-symbols-outlined text-3xl"> search </span>
</div>
<div class="flex flex-col gap-2">
<h3 class="text-xl font-bold text-white">Advanced Search</h3>
<p class="text-[var(--surface-400)]">Quickly find specific data points and trends with our powerful search functionality.</p>
</div>
</div>
</div>
</div>
<div class="flex flex-col gap-12 py-16">
<div class="flex flex-col gap-4 text-center">
<h2 class="text-5xl font-extrabold tracking-tighter text-white">Visualize Your Data</h2>
<p class="mx-auto max-w-2xl text-lg text-[var(--surface-400)]">
                Transform complex data into clear and compelling visualizations that tell a story.
              </p>
</div>
<div class="grid grid-cols-1 gap-8 sm:grid-cols-2 lg:grid-cols-3">
<div class="flex flex-col gap-4 group">
<div class="w-full overflow-hidden rounded-lg border border-[var(--surface-100)] transition-all duration-300 group-hover:border-[var(--primary-600)] group-hover:shadow-2xl group-hover:shadow-[var(--primary-800)]/40">
<img class="h-auto w-full object-cover transition-transform duration-300 group-hover:scale-105" src="https://www.statbotics.io/_next/image?url=%2Fspline.png&w=1920&q=100"/>
</div>
<div>
<h3 class="text-lg font-semibold text-white">Customizable Charts</h3>
<p class="text-[var(--surface-400)]">
                    Choose from a variety of chart types and customize them to match your brand and reporting needs.
                  </p>
</div>
</div>
<div class="flex flex-col gap-4 group">
<div class="w-full overflow-hidden rounded-lg border border-[var(--surface-100)] transition-all duration-300 group-hover:border-[var(--primary-600)] group-hover:shadow-2xl group-hover:shadow-[var(--primary-800)]/40">
<img class="h-auto w-full object-cover transition-transform duration-300 group-hover:scale-105" src="https://i.imgur.com/Svwd6hv_d.webp?maxwidth=760&fidelity=grand"/>
</div>
<div>
<h3 class="text-lg font-semibold text-white">Data Exploration</h3>
<p class="text-[var(--surface-400)]">
                    Dive deep into your data with interactive exploration tools that allow you to uncover hidden patterns.
                  </p>
</div>
</div>
<div class="flex flex-col gap-4 group">
<div class="w-full overflow-hidden rounded-lg border border-[var(--surface-100)] transition-all duration-300 group-hover:border-[var(--primary-600)] group-hover:shadow-2xl group-hover:shadow-[var(--primary-800)]/40">
<img class="h-auto w-full object-cover transition-transform duration-300 group-hover:scale-105" src="https://supabase.com/images/blog/launch-week-three/studio/open-source-studio-og.png"/>
</div>
<div>
<h3 class="text-lg font-semibold text-white">Reporting & Sharing</h3>
<p class="text-[var(--surface-400)]">
                    Generate reports and share your insights with stakeholders in a clear and concise format.
                  </p>
</div>
</div>
</div>
</div>
</div>
</main>
<footer class="border-t border-[var(--surface-100)] bg-transparent">
<div class="mx-auto max-w-7xl px-10 py-12">
<div class="flex flex-col items-center justify-between gap-8 md:flex-row">
<div class="flex flex-col items-center gap-2 md:items-start">
<div class="flex items-center gap-2">
<img class="h-10 w-10" src="https://raw.githubusercontent.com/Elixtion/elixtion.github.io/refs/heads/main/images/Untitled%20design%20(3).png" alt="CrowdScout Logo">
<span class="text-lg font-semibold text-[var(--surface-950)]">CrowdScout</span>
</div>
<p class="text-[var(--surface-500)]">© 2025 CrowdScout. All rights reserved.</p>
</div>
<div class="flex items-center gap-8">
<nav class="flex gap-6">
<a class="text-sm font-medium text-[var(--surface-500)] transition-colors hover:text-[var(--primary-500)]" href="#">Terms</a>
<a class="text-sm font-medium text-[var(--surface-500)] transition-colors hover:text-[var(--primary-500)]" href="#">Privacy</a>
<a class="text-sm font-medium text-[var(--surface-500)] transition-colors hover:text-[var(--primary-500)]" href="#">Contact</a>
</nav>
<div class="flex gap-4">
<a class="text-[var(--surface-500)] transition-colors hover:text-[var(--primary-500)]" href="#">
<svg aria-hidden="true" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
<path d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.71v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84"></path>
</svg>
</a>
<a class="text-[var(--surface-500)] transition-colors hover:text-[var(--primary-500)]" href="#">
<svg aria-hidden="true" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
<path clip-rule="evenodd" d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z" fill-rule="evenodd"></path>
</svg>
</a>
</div>
</div>
</div>
</div>
</footer>
</div>
</div>

<div id="signupModal" class="modal-centered" style="display:none">
  <div class="card bg-gradient-dark text-white">
    <button id="closeSignup" style="position:absolute; right:16px; top:16px; background:none; border:none; color:var(--surface-400); cursor:pointer; font-size:24px;"><span class="material-symbols-outlined">close</span></button>
    <header style="text-align:center; margin-bottom:10px">
      <h1 style="font-size:28px; font-weight:600; margin:0;">Sign Up</h1>
    </header>

    <form id="signupStep1Form" style="display:flex; flex-direction:column; gap:12px;">
      <label style="font-weight: normal">Display Name (Permanent)</label>
      <input id="step1Username" type="text" required />

      <label style="font-weight: normal">Email</label>
      <input id="step1Email" type="email" required />

      <label style="font-weight: noraml">Password</label>
      <input id="step1Password" type="password" required />

      <div style="display:flex; gap:8px;">
        <button type="submit" class="cta" style="flex:1">Continue</button>
        <button type="button" id="cancelSignup" style="background:#333; color:#fff; border:none; padding:12px 14px; border-radius:8px; cursor:pointer;">Cancel</button>
      </div>
      
      <div id="signupError" class="error-display" style="display:none;"></div>
      </form>
    
    <div id="signupSuccessContent" style="display:none; text-align:center; padding:20px; flex-direction: column;">
      <span class="material-symbols-outlined" style="font-size: 64px; color: var(--primary-500); margin-bottom: 20px;">
        check_circle
      </span>
      <h2 style="font-size: 24px; font-weight: 700; margin-bottom: 10px; color: var(--surface-950);">
        Account Created!
      </h2>
      <p style="color: var(--surface-400); margin-bottom: 30px; font-size: 16px;">
        <b>Please check your email</b> for the confirmation link to activate your account and log in.
      </p>
      <button type="button" class="cta" onclick="document.getElementById('signupModal').style.display='none';" style="width: 100%;">
        Got It
      </button>
    </div>
    </div>
</div>

<div id="loginModal" class="modal-centered" style="display:none">
  <div class="card bg-gradient-dark text-white">
    <button id="closeLogin" style="position:absolute; right:16px; top:16px; background:none; border:none; color:var(--surface-400); cursor:pointer; font-size:24px;">
      <span class="material-symbols-outlined">close</span>
    </button>
    <header style="text-align:center; margin-bottom:10px">
      <h1 style="font-size:28px; font-weight:600; margin:0;">Login</h1>
    </header>
    <form id="loginForm" style="display:flex; flex-direction:column; gap:12px;">
      <label style="font-weight: normal">Email</label>
      <input id="loginEmail" type="email" required />
      <label style="font-weight: normal">Password</label>
      <input id="loginPassword" type="password" required />
      <div style="display:flex; gap:8px;">
        <button type="submit" class="cta" style="flex:1">Login</button>
        <button type="button" id="cancelLogin" style="background:#333; color:#fff; border:none; padding:12px 14px; border-radius:8px; cursor:pointer;">Cancel</button>
      </div>
      
      <div id="loginError" class="error-display" style="display:none;"></div>
      <div style="display:flex; justify-content:center; gap:8px; margin-top:6px; align-items:center;">
        <button type="button" id="forgotPasswordBtn" style="background:none; border:none; color:var(--surface-400); cursor:pointer; font-size:14px; text-decoration:underline;">Forgot password?</button>
      </div>
    </form>
  </div>
</div>

<div id="resetPasswordModal" class="modal-centered" style="display:none">
  <div class="card bg-gradient-dark text-white">
    <button id="closeReset" style="position:absolute; right:16px; top:16px; background:none; border:none; color:var(--surface-400); cursor:pointer; font-size:24px;">
      <span class="material-symbols-outlined">close</span>
    </button>
    <header style="text-align:center; margin-bottom:10px">
      <h1 style="font-size:22px; margin:0;">Reset password</h1>
    </header>
    <form id="resetForm" style="display:flex; flex-direction:column; gap:12px;">
      <label style="font-weight:600">Enter the email for your account</label>
      <input id="resetEmail" type="email" required />
      <div style="display:flex; gap:8px;">
        <button type="submit" class="cta" style="flex:1">Send reset link</button>
        <button type="button" id="cancelReset" style="background:#333; color:#fff; border:none; padding:12px 14px; border-radius:8px; cursor:pointer;">Cancel</button>
      </div>
    </form>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  // -------------------------
  // Supabase initialization
  // -------------------------
  const SUPABASE_URL = "https://kstzwynylwcvqmkzkjvr.supabase.co"
  const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtzdHp3eW55bHdjdnFta3pranZyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY1OTc3OTgsImV4cCI6MjA3MjE3Mzc5OH0.JvilpVaPUCEj0p9Ty4EHdtruq5yico79HWn8Uq6Lqjo'
  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  // -------------------------
  // DOM references
  // -------------------------
  const profileBtn = document.getElementById('profileBtn');
  const profileDropdown = document.getElementById('profileDropdown'); 
  const landingAvatar = document.getElementById('landingAvatar');

  // Modals & forms
  const signupModal = document.getElementById('signupModal');
  const signupForm = document.getElementById('signupStep1Form');
  const closeSignup = document.getElementById('closeSignup');
  const cancelSignup = document.getElementById('cancelSignup');
  const signupError = document.getElementById('signupError'); 
  const signupSuccessContent = document.getElementById('signupSuccessContent'); 

  const loginModal = document.getElementById('loginModal');
  const loginForm = document.getElementById('loginForm');
  const closeLogin = document.getElementById('closeLogin');
  const cancelLogin = document.getElementById('cancelLogin');
  const loginError = document.getElementById('loginError'); 

  const resetModal = document.getElementById('resetPasswordModal');
  const resetForm = document.getElementById('resetForm');
  const closeReset = document.getElementById('closeReset');
  const cancelReset = document.getElementById('cancelReset');

  // Buttons
  const signupOpen = document.getElementById('signupOpen');
  const loginLinkBtn = document.getElementById('loginLinkBtn');
  const forgotPasswordBtn = document.getElementById('forgotPasswordBtn');

  // Utility: simple show/hide helpers
  const showElem = (el) => { if (el) el.style.display = 'flex'; }
  const hideElem = (el) => { if (el) el.style.display = 'none'; }
  
  // Utility: Error Display
  const showError = (el, message) => {
    if (el) {
      el.textContent = message;
      el.style.display = 'block';
    }
  }
  const clearError = (el) => {
    if (el) {
      el.textContent = '';
      el.style.display = 'none';
    }
  }

  // -------------------------
  // Create logged-in dropdown (dynamically)
  // -------------------------
  function ensureLoggedInDropdown() {
    let existing = document.getElementById('profileDropdownLoggedIn');
    if (existing) return existing;

    const dropdown = document.createElement('div');
    dropdown.id = 'profileDropdownLoggedIn';
    dropdown.className = 'dropdown';
    dropdown.setAttribute('role', 'menu');
    // Note: dropdown.style.display is not set here; it's controlled by JS below
    // and relies on the new CSS definition of .dropdown

    // Profile link
    const profileLink = document.createElement('a');
    profileLink.href = 'https://elixtion.github.io/profile';
    profileLink.textContent = 'Profile';
    dropdown.appendChild(profileLink);

    // Logout button
    const logoutBtn = document.createElement('button');
    logoutBtn.id = 'logoutBtn';
    logoutBtn.textContent = 'Logout';
    dropdown.appendChild(logoutBtn);

    // External link (same as logged-out)
    const cd = document.createElement('a');
    cd.href = 'https://www.chiefdelphi.com';
    cd.target = '_blank';
    cd.rel = 'noopener';
    cd.innerHTML = 'Chief Delphi <span class="material-symbols-outlined" style="margin-left:auto;font-size:18px">open_in_new</span>';
    dropdown.appendChild(cd);

    // attach after the existing logged-out dropdown (or profile container)
    if (profileDropdown && profileDropdown.parentNode) {
      profileDropdown.parentNode.appendChild(dropdown);
    } else {
      document.body.appendChild(dropdown);
    }

    // Add logout handler
    logoutBtn.addEventListener('click', async () => {
      try {
        const { error } = await supabase.auth.signOut();
        if (error) throw error;
        updateUIForAuthState();
      } catch (err) {
        console.error('Logout error', err);
      }
    });

    return dropdown;
  }

  // -------------------------
  // Dropdown behavior (avatar button)
  // -------------------------
  profileBtn.addEventListener('click', async (ev) => {
    ev.stopPropagation();
    const sessionResp = await supabase.auth.getSession();
    const session = sessionResp?.data?.session ?? null;
    const loggedInDropdown = ensureLoggedInDropdown();
    const isShowingLoggedIn = loggedInDropdown.style.display === 'flex'; // CHANGED from 'block'
    const isShowingLoggedOut = profileDropdown.style.display === 'flex'; // CHANGED from 'block'

    if (session) {
      // toggle logged-in dropdown
      loggedInDropdown.style.display = isShowingLoggedIn ? 'none' : 'flex'; // CHANGED from 'block'
      if (profileDropdown) profileDropdown.style.display = 'none';
    } else {
      // toggle logged-out dropdown
      if (profileDropdown) profileDropdown.style.display = isShowingLoggedOut ? 'none' : 'flex'; // CHANGED from 'block'
      if (loggedInDropdown) loggedInDropdown.style.display = 'none';
    }
  });

  // Clicking outside closes any dropdown
  document.addEventListener('click', () => {
    if (profileDropdown) profileDropdown.style.display = 'none';
    const li = document.getElementById('profileDropdownLoggedIn');
    if (li) li.style.display = 'none';
  });

  // -------------------------
  // Modal open/close helpers
  // -------------------------
  // Sign up
  if (signupOpen) signupOpen.addEventListener('click', () => { 
    showElem(signupModal); 
    if (profileDropdown) profileDropdown.style.display = 'none'; 
    clearError(signupError); // Clear error on open
    showElem(signupForm); // Ensure form is visible
    hideElem(signupSuccessContent); // Ensure success is hidden
  });
  if (closeSignup) closeSignup.addEventListener('click', () => hideElem(signupModal));
  if (cancelSignup) cancelSignup.addEventListener('click', () => hideElem(signupModal));

  // Login
  if (loginLinkBtn) loginLinkBtn.addEventListener('click', () => { 
    showElem(loginModal); 
    if (profileDropdown) profileDropdown.style.display = 'none'; 
    clearError(loginError); // Clear error on open
  });
  if (closeLogin) closeLogin.addEventListener('click', () => hideElem(loginModal));
  if (cancelLogin) cancelLogin.addEventListener('click', () => hideElem(loginModal));

  // Reset
  if (forgotPasswordBtn) forgotPasswordBtn.addEventListener('click', () => { 
    showElem(resetModal); 
    hideElem(loginModal); 
  });
  if (closeReset) closeReset.addEventListener('click', () => hideElem(resetModal));
  if (cancelReset) cancelReset.addEventListener('click', () => hideElem(resetModal));
  // ESC key closes modals
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      hideElem(signupModal);
      hideElem(loginModal);
      hideElem(resetModal);
    }
  });

  // -------------------------
  // Signup handler (email confirmation enabled)
  // -------------------------
  if (signupForm) {
    signupForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      clearError(signupError);

      const username = (document.getElementById('step1Username') || {}).value?.trim();
      const email = (document.getElementById('step1Email') || {}).value?.trim();
      const password = (document.getElementById('step1Password') || {}).value;

      if (!username || !email || !password) {
        showError(signupError, 'Please fill in all sign-up fields.');
        return;
      }

      try {
        // Sign up user — duplicate emails will throw automatically
        const { data, error } = await supabase.auth.signUp({
          email,
          password,
          options: {
            data: { username },
            emailRedirectTo: 'https://elixtion.github.io/confirm'
          }
        });

        if (error) throw error;
        
        // **(The profile is now created securely by your database trigger)**

        hideElem(signupForm);
        showElem(signupSuccessContent);
        signupForm.reset();
      } catch (err) {
        console.error('SignUp error', err);
        // Supabase auth.signUp error message already covers duplicate email
        showError(signupError, 'Sign-up error: ' + (err.message || err));
      }
    });
  }

  // -------------------------
  // Login handler
  // -------------------------
  if (loginForm) {
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      clearError(loginError); // Clear previous errors
      
      const email = (document.getElementById('loginEmail') || {}).value?.trim();
      const password = (document.getElementById('loginPassword') || {}).value;

      if (!email || !password) {
        showError(loginError, 'Please fill in both email and password.');
        return;
      }

      try {
        const { data, error } = await supabase.auth.signInWithPassword({ email, password });
        if (error) throw error;

        const session = data?.session ?? null;
        const user = data?.user ?? null;

        // If Supabase requires email confirmation and the user wasn't confirmed, handle gracefully:
        const confirmedAt = user?.email_confirmed_at || user?.confirmed_at || null;
        if (user && !confirmedAt) {
          // if the account isn't confirmed, sign them out and ask them to confirm
          await supabase.auth.signOut();
          showError(loginError, 'Please confirm your email address (check your inbox) before logging in.');
          return;
        }

        hideElem(loginModal);
        loginForm.reset();
        
        // Check if user came from profile page, otherwise stay on test page
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('from') === 'profile') {
          window.location.href = 'https://elixtion.github.io/profile';
        } else {
          updateUIForAuthState();
        }

      } catch (err) {
        console.error('Login error', err);
        // supabase may return an error message detailing email not confirmed
        showError(loginError, 'Login error: ' + (err.message || err));
      }
    });
  }

  // -------------------------
  // Forgot password (reset) handler
  // -------------------------
  if (resetForm) {
    resetForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = (document.getElementById('resetEmail') || {}).value?.trim();
      if (!email) {
        alert('Please provide the email for your account.');
        return;
      }

      try {
        // Supabase v2 client method for sending a password reset email:
        const { data, error } = await supabase.auth.resetPasswordForEmail(email, {
          redirectTo: window.location.origin + '/reset-password'
        });
        if (error) throw error;

        alert('If that email exists you will receive a password reset link shortly. Check your inbox.');
        hideElem(resetModal);
        resetForm.reset();
      } catch (err) {
        console.error('Reset error', err);
        alert('Error sending reset link: ' + (err.message || err));
      }
    });
  }

  // -------------------------
  // Keep UI in sync with auth state
  // -------------------------
  async function updateUIForAuthState() {
    try {
      const { data: { session } } = await supabase.auth.getSession();
      const loggedInDropdown = ensureLoggedInDropdown();
      if (session && session.user) {
        // show logged-in dropdown option (but default hidden until avatar clicked)
        hideElem(profileDropdown);
        hideElem(document.getElementById('profileDropdownLoggedIn')); // to be safe, hide before update
        // update avatar (if user's metadata contains an avatar url)
        const user = session.user;
        const avatarUrl = (user?.user_metadata && user.user_metadata.avatar_url) || null;
        if (avatarUrl && landingAvatar) landingAvatar.src = avatarUrl;
        // Optionally show name on avatar title
        if (landingAvatar) landingAvatar.title = user?.email || (user?.user_metadata?.username || 'Profile');

        // ensure logged-in dropdown exists (created earlier)
        // we keep it hidden until avatar clicked — so nothing else to show here
      } else {
        // not logged in
        if (landingAvatar) {
          landingAvatar.src = 'https://upload.wikimedia.org/wikipedia/commons/a/aa/Sin_cara.png';
          landingAvatar.title = 'Not signed in';
        }
        hideElem(document.getElementById('profileDropdownLoggedIn'));
        // ensure logged-out dropdown is hidden by default
        if (profileDropdown) profileDropdown.style.display = 'none';
      }
    } catch (err) {
      console.error('Error updating UI for auth state', err);
    }
  }

  // Run once on load
  updateUIForAuthState();

  // Listen for auth state changes and keep UI in sync
  supabase.auth.onAuthStateChange((event, session) => {
    console.log('Auth event:', event);
    updateUIForAuthState();
  });
});
</script>
</body></html>